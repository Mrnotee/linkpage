<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mr.putra | Link Page</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <style>
    body{
      margin:0;
      font-family:Arial,sans-serif;
      background: linear-gradient(180deg,#020817 0%, #071229 100%);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      padding: 12px;
    }
    .wrap{
      max-width:420px;
      width:100%;
      padding:20px;
      box-sizing: border-box;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    .avatar{
      width:80px;
      height:80px;
      border-radius:12px;
      object-fit:cover;
      border:3px solid rgba(255,255,255,0.2);
      margin-bottom: 12px;
      background: rgba(0,0,0,0.2);
    }
    h1{margin:10px 0 4px}
    p{margin:0 0 20px;color:#ddd}
    .link-item{
      display:flex;
      align-items:center;
      gap:12px;
      background:rgba(56,45,36,0.95);
      padding:14px;
      border-radius:12px;
      text-decoration:none;
      color:#d9c8b8;
      margin-bottom:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      user-select:none;
    }
    .link-item:hover{
      transform:translateY(-2px);
      box-shadow:0 10px 26px rgba(0,0,0,0.45);
    }
    .icon-wrap{
      width:44px;
      height:44px;
      border-radius:10px;
      background:rgba(0,0,0,0.15);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      font-size: 22px;
      color: #d9c8b8;
      overflow: hidden;
    }
    .icon-img{
      width: 70%;
      height: 70%;
      object-fit: contain;
      display: block;
      filter: none;
    }

    /* tombol edit */
    .edit-toggle {
      position:fixed;
      right:18px;
      bottom:18px;
      background:#2f3742;
      color:#fff;
      padding:12px;
      border-radius:999px;
      box-shadow:0 8px 26px rgba(0,0,0,0.5);
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      z-index:100;
      user-select:none;
    }
    .editor{
      position:fixed;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      width:95%;
      max-width:640px;
      background:#07121a;
      padding:18px;
      border-radius:12px;
      box-shadow:0 20px 60px rgba(2,6,23,0.8);
      z-index:200;
      display:none;
      flex-direction:column;
      gap:12px;
      color:#ddd;
      max-height:90vh;
      overflow-y:auto;
    }
    .editor.open {display:flex}
    input[type=text], input[type=url], select {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.06);
      background:rgba(255,255,255,0.02);
      color:#fff;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input.invalid, select.invalid {
      border-color: #e34a4a;
      background: rgba(227, 74, 74, 0.15);
    }
    label {
      font-weight: 600;
      margin-bottom: 4px;
      display: block;
      user-select:none;
    }
    .btn {
      padding:8px 12px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      user-select:none;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    .btn.primary {
      background:#2b8a74;
      color:#fff;
    }
    .btn.primary:hover {
      background:#23705f;
    }
    .btn.ghost {
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:#fff;
    }
    .btn.ghost:hover {
      background:rgba(255,255,255,0.1);
    }

    /* Editor items */
    #itemsEditor {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .item-row {
      display: grid;
      grid-template-columns: 64px 1fr auto;
      gap: 10px;
      align-items: center;
      background: rgba(56,45,36,0.8);
      padding: 10px;
      border-radius: 10px;
      user-select:none;
      cursor: grab;
    }
    .item-row.dragging { opacity: 0.5; cursor: grabbing; }
    .item-preview {
      text-align: center;
      color: #d9c8b8;
      font-size: 22px;
      user-select:none;
    }
    .item-text-preview {
      color: #d9c8b8;
      font-size: 12px;
      margin-top: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      user-select:none;
    }
    .item-fields {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }
    .icon-type-row {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 8px;
      align-items: center;
    }
    .icon-hint {
      font-size: 12px; color:#bbb;
    }
    .btn-delete {
      background: #e34a4a;
      color: #fff;
      border-radius: 9999px;
      width: 32px;
      height: 32px;
      font-size: 20px;
      line-height: 30px;
      padding: 0;
      text-align: center;
      cursor: pointer;
      user-select:none;
      border:none;
      transition: background-color 0.3s ease;
    }
    .btn-delete:hover { background: #c03939; }

    /* Export/Import buttons container */
    .export-import-container {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .file-input { display: none; }

    /* Background video behind everything */
    #bgVideo {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      object-fit: cover;
      z-index: 0;
      pointer-events: none;
      opacity: .8;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .wrap { max-width: 100%; padding: 10px; }
      .avatar { width: 64px; height: 64px; }
      .edit-toggle { padding: 10px 14px; gap: 6px; bottom: 12px; right: 12px; }
      .editor { max-width: 95vw; width: 95vw; max-height: 95vh; }
      .item-row { grid-template-columns: 56px 1fr auto; }
      .icon-type-row { grid-template-columns: 120px 1fr; }
    }
  </style>
</head>
<body>

  <!-- Background Video -->
  <video autoplay muted loop id="bgVideo">
    <source src="api.mp4" type="video/mp4">
  </video>

  <div class="wrap" align="center">
    <img class="avatar" id="avatarImg" src="avatar-halaman.jpg" alt="avatar">
    <h1 id="pageTitle">Mr.putra</h1>
    <p id="pageSubtitle">Kumpulan Sosial media</p>
    <div id="linksList"></div>
  </div>

  <!-- tombol edit -->
  <div class="edit-toggle" id="toggleEditor" title="Edit halaman" role="button" tabindex="0" aria-label="Edit halaman">
    <i class="fa-solid fa-pen-to-square"></i>
    <span style="font-weight:700">Edit</span>
  </div>

  <!-- editor modal -->
  <div class="editor" id="editor" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
    <h3 id="editorTitle">Edit Link Page</h3>
    <div>
      <label for="titleInput">Judul</label>
      <input id="titleInput" type="text" autocomplete="off" spellcheck="false" />
    </div>
    <div>
      <label for="subtitleInput">Deskripsi</label>
      <input id="subtitleInput" type="text" autocomplete="off" spellcheck="false" />
    </div>
    <div>
      <label for="avatarInput">Avatar (URL gambar)</label>
      <input id="avatarInput" type="url" autocomplete="off" spellcheck="false" placeholder="https://example.com/image.jpg" />
    </div>
    <hr />
    <div id="itemsEditor" aria-live="polite" aria-relevant="additions removals"></div>
    <button class="btn ghost" id="addItemBtn" type="button">+ Tambah Tombol</button>

    <div class="export-import-container">
      <button class="btn ghost" id="exportBtn" type="button" title="Export data ke file JSON">Export JSON</button>
      <label for="importFile" class="btn ghost" style="cursor:pointer;" title="Import data dari file JSON">Import JSON</label>
      <input type="file" accept=".json,application/json" id="importFile" class="file-input" aria-label="Import data JSON" />
    </div>

    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
      <button class="btn primary" id="saveBtn" type="button">Simpan</button>
      <button class="btn ghost" id="closeBtn" type="button">Tutup</button>
    </div>
  </div>

  <script>
    // =======================
    // Default items (backward compatible: iconType = 'fa')
    // =======================
    const DEFAULT = [
      {iconType: "fa", iconClass: "fa-brands fa-tiktok", iconUrl: "", text: "TikTok", url: "https://www.tiktok.com/@_jangkrik_01?_t=ZS-8yojMuYRjXO&_r=1"},
      {iconType: "fa", iconClass: "fa-brands fa-instagram", iconUrl: "", text: "Instagram", url: "https://www.instagram.com/____mr_r_?igsh=cWZ4M3FxdDVsajV0"},
      {iconType: "fa", iconClass: "fa-brands fa-youtube", iconUrl: "", text: "YouTube", url: "https://youtube.com/@rnote01?si=EbPWpt3hs8l2YJzu"}
    ];

    // --- Load & Save data from localStorage ---
    function loadData(){
      try {
        const raw = localStorage.getItem("linkpage_data");
        if(raw) {
          const parsed = JSON.parse(raw);
          // Migrasi items lama (yang belum punya iconType/iconUrl)
          parsed.items = (parsed.items || []).map(it => ({
            iconType: it.iconType || "fa",
            iconClass: it.iconClass || "fa-solid fa-link",
            iconUrl: it.iconUrl || "",
            text: it.text || "Tombol",
            url: it.url || "#"
          }));
          return parsed;
        }
      } catch(e) {}
      return {
        title: "Mr.putra",
        subtitle: "Kumpulan Sosial media",
        avatar: "avatar-halaman.jpg",
        items: DEFAULT
      };
    }
    function saveData(state){
      localStorage.setItem("linkpage_data", JSON.stringify(state));
    }

    // --- Validation helpers ---
    function isValidURL(str) {
      try {
        const url = new URL(str);
        return url.protocol === "http:" || url.protocol === "https:";
      } catch {
        return false;
      }
    }
    // Deteksi kelas FA minimal: harus ada 'fa-' dan kelas gaya (fa-solid/fa-regular/fa-brands/...)
    function isValidIconClass(cls) {
      const s = (cls || "").trim();
      if(!s) return true;
      const hasStyle = /\bfa-(solid|regular|brands|light|thin|duotone|sharp)\b/i.test(s) || /\bfa[srldb]\b/.test(s);
      const hasIcon = /\bfa-[a-z0-9-]+\b/i.test(s.replace(/\bfa-(solid|regular|brands|light|thin|duotone|sharp)\b/ig,'').trim());
      return hasStyle && hasIcon;
    }

    // --- Main app state ---
    let state = loadData();

    // --- Rendering main link list ---
    function renderList(state){
      const list = document.getElementById("linksList");
      list.innerHTML = "";
      state.items.forEach(it => {
        const a = document.createElement("a");
        a.href = it.url || "#";
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.className = "link-item";

        const iconWrap = document.createElement("div");
        iconWrap.className = "icon-wrap";

        if(it.iconType === "img" && isValidURL(it.iconUrl)) {
          const img = document.createElement("img");
          img.src = it.iconUrl;
          img.alt = "icon";
          img.className = "icon-img";
          iconWrap.appendChild(img);
        } else {
          const icon = document.createElement("i");
          icon.className = isValidIconClass(it.iconClass) ? it.iconClass : "fa-solid fa-link";
          iconWrap.appendChild(icon);
        }

        a.appendChild(iconWrap);
        a.appendChild(document.createTextNode(it.text || "Tombol"));
        list.appendChild(a);
      });
    }

    // --- Update main page from state ---
    function updateMainPage() {
      document.getElementById("pageTitle").textContent = state.title;
      document.getElementById("pageSubtitle").textContent = state.subtitle;
      document.getElementById("avatarImg").src = state.avatar;
      renderList(state);
    }
    updateMainPage();

    // --- Editor modal & elements ---
    const editorEl = document.getElementById("editor");
    const titleInput = document.getElementById("titleInput");
    const subtitleInput = document.getElementById("subtitleInput");
    const avatarInput = document.getElementById("avatarInput");
    const itemsEditor = document.getElementById("itemsEditor");
    const addItemBtn = document.getElementById("addItemBtn");
    const saveBtn = document.getElementById("saveBtn");
    const closeBtn = document.getElementById("closeBtn");
    const toggleEditorBtn = document.getElementById("toggleEditor");
    const exportBtn = document.getElementById("exportBtn");
    const importFileInput = document.getElementById("importFile");

    // --- Open editor & build editor UI ---
    toggleEditorBtn.onclick = () => openEditor();
    toggleEditorBtn.onkeydown = (e)=>{ if(e.key === 'Enter' || e.key === ' ') openEditor(); };
    closeBtn.onclick = () => editorEl.classList.remove("open");

    function openEditor() {
      editorEl.classList.add("open");
      titleInput.value = state.title;
      subtitleInput.value = state.subtitle;
      avatarInput.value = state.avatar;
      buildItemsEditor();
    }

    // --- Build editor items list with drag & drop, live preview, validation & delete ---
    function buildItemsEditor() {
      itemsEditor.innerHTML = "";
      state.items.forEach((it, idx) => {
        const row = document.createElement("div");
        row.className = "item-row";
        
        // Remove row draggable by default

        row.dataset.index = idx;

        // Preview
        const previewDiv = document.createElement("div");
        previewDiv.className = "item-preview";
        const previewIconWrap = document.createElement("div");
        previewIconWrap.className = "icon-wrap";
        const previewIconEl = document.createElement("i");
        const previewImgEl = document.createElement("img");
        previewImgEl.className = "icon-img";

        function setPreview() {
          previewIconWrap.innerHTML = "";
          if(it.iconType === "img" && isValidURL(it.iconUrl)) {
            previewImgEl.src = it.iconUrl;
            previewIconWrap.appendChild(previewImgEl);
          } else {
            previewIconEl.className = isValidIconClass(it.iconClass) ? it.iconClass : "fa-solid fa-link";
            previewIconWrap.appendChild(previewIconEl);
          }
        }
        setPreview();

        const previewText = document.createElement("div");
        previewText.className = "item-text-preview";
        previewText.textContent = it.text || "(Kosong)";

        previewDiv.appendChild(previewIconWrap);
        
        // Drag handle
        const dragHandle = document.createElement("div");
        dragHandle.className = "drag-handle";
        dragHandle.title = "Geser untuk urutkan";
        dragHandle.innerHTML = "&#x2630;"; // hamburger icon
        dragHandle.style.cursor = "grab";
        dragHandle.style.fontSize = "18px";
        dragHandle.style.userSelect = "none";
        dragHandle.setAttribute("draggable", "true");
previewDiv.appendChild(previewText);

        // Fields
        const fields = document.createElement("div");
        fields.className = "item-fields";

        // Icon type + label
        const iconTypeRow = document.createElement("div");
        iconTypeRow.className = "icon-type-row";

        const iconTypeLabel = document.createElement("label");
        iconTypeLabel.textContent = "Jenis Ikon";
        iconTypeLabel.htmlFor = `iconType-${idx}`;

        const iconTypeSelect = document.createElement("select");
        iconTypeSelect.id = `iconType-${idx}`;
        iconTypeSelect.innerHTML = `
          <option value="fa">Font Awesome</option>
          <option value="img">Gambar (URL)</option>
        `;
        iconTypeSelect.value = it.iconType || "fa";

        iconTypeRow.appendChild(iconTypeLabel);
        iconTypeRow.appendChild(iconTypeSelect);

        // Text
        const textLabel = document.createElement("label");
        textLabel.textContent = "Teks tombol";
        textLabel.htmlFor = `text-${idx}`;
        const textInput = document.createElement("input");
        textInput.type = "text";
        textInput.id = `text-${idx}`;
        textInput.value = it.text || "";
        textInput.placeholder = "Contoh: Beli di Shopee";

        // URL
        const urlLabel = document.createElement("label");
        urlLabel.textContent = "URL";
        urlLabel.htmlFor = `url-${idx}`;
        const urlInput = document.createElement("input");
        urlInput.type = "url";
        urlInput.id = `url-${idx}`;
        urlInput.value = it.url || "";
        urlInput.placeholder = "https://link-produk-anda";

        // Icon (FA)
        const faLabel = document.createElement("label");
        faLabel.textContent = "Kelas ikon Font Awesome";
        faLabel.htmlFor = `iconClass-${idx}`;
        const iconInput = document.createElement("input");
        iconInput.type = "text";
        iconInput.id = `iconClass-${idx}`;
        iconInput.value = it.iconClass || "fa-solid fa-link";
        iconInput.placeholder = "mis: fa-brands fa-instagram";
        const faHint = document.createElement("div");
        faHint.className = "icon-hint";
        faHint.textContent = "Gunakan kelas FA valid (contoh: fa-brands fa-instagram, fa-solid fa-link)";

        // Icon (IMG URL)
        const imgLabel = document.createElement("label");
        imgLabel.textContent = "URL gambar ikon (PNG/JPG/SVG)";
        imgLabel.htmlFor = `iconUrl-${idx}`;
        const iconUrlInput = document.createElement("input");
        iconUrlInput.type = "url";
        iconUrlInput.id = `iconUrl-${idx}`;
        iconUrlInput.value = it.iconUrl || "";
        iconUrlInput.placeholder = "https://domain.com/logo-produk.png";

        // toggle visibility by type
        function toggleIconFields() {
          const isFA = iconTypeSelect.value === "fa";
          iconInput.parentElement.style.display = isFA ? "block" : "none";
          faLabel.style.display = isFA ? "block" : "none";
          faHint.style.display = isFA ? "block" : "none";

          iconUrlInput.parentElement.style.display = isFA ? "none" : "block";
          imgLabel.style.display = isFA ? "none" : "block";
        }

        // Wrap each input with its label nicely
        const wrap = (labelEl, inputEl, extra) => {
          const c = document.createElement("div");
          c.appendChild(labelEl);
          c.appendChild(inputEl);
          if(extra) c.appendChild(extra);
          return c;
        };

        fields.appendChild(iconTypeRow);
        fields.appendChild(wrap(textLabel, textInput));
        fields.appendChild(wrap(urlLabel, urlInput));
        fields.appendChild(wrap(faLabel, iconInput, faHint));
        fields.appendChild(wrap(imgLabel, iconUrlInput));

        // Delete button
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn-delete";
        deleteBtn.title = "Hapus tombol ini";
        deleteBtn.type = "button";
        deleteBtn.innerHTML = "&times;";
        deleteBtn.onclick = () => {
          state.items.splice(idx, 1);
          buildItemsEditor();
        };

        row.appendChild(previewDiv);
        row.appendChild(dragHandle);
        row.appendChild(fields);
        row.appendChild(deleteBtn);
        itemsEditor.appendChild(row);

        // Initial toggle fields
        toggleIconFields();

        // Listeners (live preview + sync state + validation)
        iconTypeSelect.addEventListener("change", () => {
          it.iconType = iconTypeSelect.value;
          toggleIconFields();
          setPreview();
        });

        textInput.addEventListener("input", () => {
          it.text = textInput.value;
          previewText.textContent = textInput.value.trim() || "(Kosong)";
        });

        urlInput.addEventListener("input", () => {
          it.url = urlInput.value.trim();
          if(it.url === "" || isValidURL(it.url)) urlInput.classList.remove("invalid");
          else urlInput.classList.add("invalid");
        });

        iconInput.addEventListener("input", () => {
          it.iconClass = iconInput.value.trim();
          if(it.iconClass === "" || isValidIconClass(it.iconClass)) {
            iconInput.classList.remove("invalid");
          } else {
            iconInput.classList.add("invalid");
          }
          setPreview();
        });

        iconUrlInput.addEventListener("input", () => {
          it.iconUrl = iconUrlInput.value.trim();
          if(it.iconUrl === "" || isValidURL(it.iconUrl)) {
            iconUrlInput.classList.remove("invalid");
          } else {
            iconUrlInput.classList.add("invalid");
          }
          setPreview();
        });
      });

      setupDragAndDrop();
    }

    // --- Drag & Drop support ---
    function setupDragAndDrop() {
      let dragSrcEl = null;
      function handleDragStart(e) {
        dragSrcEl = this;
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
      }
      function handleDragOver(e) {
        if (e.preventDefault) e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        return false;
      }
      function handleDragEnter() { this.classList.add('over'); }
      function handleDragLeave() { this.classList.remove('over'); }
      function handleDrop(e) {
        if (e.stopPropagation) e.stopPropagation();
        if (dragSrcEl !== this) {
          const fromIdx = Number(dragSrcEl.dataset.index);
          const toIdx = Number(this.dataset.index);
          const moved = state.items.splice(fromIdx, 1)[0];
          state.items.splice(toIdx, 0, moved);
          buildItemsEditor();
        }
        return false;
      }
      function handleDragEnd() {
        this.classList.remove('dragging');
        itemsEditor.querySelectorAll('.item-row').forEach(r => r.classList.remove('over'));
      }

      itemsEditor.querySelectorAll('.drag-handle').forEach(handle => {
        row.addEventListener('dragstart', handleDragStart, false);
        row.addEventListener('dragenter', handleDragEnter, false);
        row.addEventListener('dragover', handleDragOver, false);
        row.addEventListener('dragleave', handleDragLeave, false);
        row.addEventListener('drop', handleDrop, false);
        row.addEventListener('dragend', handleDragEnd, false);
      });
    }

    // --- Collect items data from inputs, validate before save ---
    function collectItems() {
      // Ambil ulang dari state (karena state selalu tersinkron lewat input listeners)
      // dan lakukan validasi final.
      const items = state.items.map(it => ({...it}));
      let valid = true;

      items.forEach((it, i) => {
        if(!it.text || !it.text.trim()) valid = false;

        if(it.url && !isValidURL(it.url)) valid = false;

        if(it.iconType === "fa") {
          if(it.iconClass && !isValidIconClass(it.iconClass)) valid = false;
        } else if(it.iconType === "img") {
          if(it.iconUrl && !isValidURL(it.iconUrl)) valid = false;
        } else {
          valid = false;
        }

        // Normalisasi default
        if(!it.iconType) it.iconType = "fa";
        if(it.iconType === "fa" && !it.iconClass) it.iconClass = "fa-solid fa-link";
        if(it.iconType === "img" && !it.iconUrl) { it.iconType = "fa"; it.iconClass = "fa-solid fa-link"; }
      });

      return valid ? items : null;
    }

    // --- Save button handler ---
    document.getElementById("saveBtn").onclick = () => {
      const itemsCollected = collectItems();
      if(!itemsCollected) {
        alert("Periksa inputan, ada yang tidak valid atau kosong.");
        return;
      }

      const titleVal = titleInput.value.trim();
      const subtitleVal = subtitleInput.value.trim();
      const avatarVal = avatarInput.value.trim();

      if(titleVal === "") {
        alert("Judul tidak boleh kosong.");
        titleInput.classList.add("invalid");
        return;
      } else {
        titleInput.classList.remove("invalid");
      }

      if (avatarVal !== "") {
  if (avatarVal.startsWith("http://") || avatarVal.startsWith("https://")) {
    if (!isValidURL(avatarVal)) {
      alert("URL avatar tidak valid.");
      avatarInput.classList.add("invalid");
      return;
    } else {
      avatarInput.classList.remove("invalid");
    }
  } else {
    // dianggap nama file lokal
    avatarInput.classList.remove("invalid");
  }
} else {
  avatarInput.classList.remove("invalid");
}


      state.title = titleVal;
      state.subtitle = subtitleVal;
      state.avatar = avatarVal || "avatar-halaman.jpg";
      state.items = itemsCollected;
      saveData(state);
      updateMainPage();
      editorEl.classList.remove("open");
    };

    // --- Add new item button ---
    document.getElementById("addItemBtn").onclick = () => {
      state.items.push({iconType:"fa", iconClass:"fa-solid fa-link", iconUrl:"", text:"Tombol Baru", url:"#"});
      buildItemsEditor();
    };

    // --- Export to JSON file ---
    document.getElementById("exportBtn").onclick = () => {
      const dataStr = JSON.stringify(state, null, 2);
      const blob = new Blob([dataStr], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "linkpage-data.json";
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    };

    // --- Import JSON file handler ---
    document.getElementById("importFile").onchange = (e) => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const imported = JSON.parse(event.target.result);
          if(imported.title && typeof imported.subtitle === "string" && imported.avatar && Array.isArray(imported.items)) {
            // Migrasi jika perlu
            imported.items = (imported.items || []).map(it => ({
              iconType: it.iconType || "fa",
              iconClass: it.iconClass || "fa-solid fa-link",
              iconUrl: it.iconUrl || "",
              text: it.text || "Tombol",
              url: it.url || "#"
            }));
            state = imported;
            saveData(state);
            updateMainPage();
            alert("Import berhasil!");
            editorEl.classList.remove("open");
          } else {
            alert("File JSON tidak valid.");
          }
        } catch {
          alert("Gagal membaca file JSON.");
        }
      };
      reader.readAsText(file);
      e.target.value = "";
    };
  </script>

<script>
// === Auto-select text feature ===
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key.toLowerCase() === 'a') {
    const el = document.activeElement;
    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
      e.preventDefault();
      el.select();
    }
  }
});
</script>
</body>

</html>
